{"version":3,"file":"utils.js","sources":["../../src/utils.ts"],"sourcesContent":["\nimport TomSelect from './tom-select';\nimport { TomLoadCallback } from './types/index';\n\n\n/**\n * Converts a scalar to its best string representation\n * for hash keys and HTML attribute values.\n *\n * Transformations:\n *   'str'     -> 'str'\n *   null      -> ''\n *   undefined -> ''\n *   true      -> '1'\n *   false     -> '0'\n *   0         -> '0'\n *   1         -> '1'\n *\n */\nexport const hash_key = (value:undefined|null|boolean|string|number):string|null => {\n\tif (typeof value === 'undefined' || value === null) return null;\n\treturn get_hash(value);\n};\n\nexport const get_hash = (value:boolean|string|number):string => {\n\tif (typeof value === 'boolean') return value ? '1' : '0';\n\treturn value + '';\n};\n\n/**\n * Escapes a string for use within HTML.\n *\n */\nexport const escape_html = (str:string):string => {\n\treturn (str + '')\n\t\t.replace(/&/g, '&amp;')\n\t\t.replace(/</g, '&lt;')\n\t\t.replace(/>/g, '&gt;')\n\t\t.replace(/\"/g, '&quot;');\n};\n\n\n/**\n * Debounce the user provided load function\n *\n */\nexport const loadDebounce = (fn:(value:string,callback:TomLoadCallback) => void,delay:number) => {\n\tvar timeout: null|ReturnType<typeof setTimeout>;\n\treturn function(this:TomSelect, value:string,callback:TomLoadCallback) {\n\t\tvar self = this;\n\n\t\tif( timeout ){\n\t\t\tself.loading = Math.max(self.loading - 1, 0);\n\t\t\tclearTimeout(timeout);\n\t\t}\n\t\ttimeout = setTimeout(function() {\n\t\t\ttimeout = null;\n\t\t\tself.loadedSearches[value] = true;\n\t\t\tfn.call(self, value, callback);\n\n\t\t}, delay);\n\t};\n};\n\n\n/**\n * Debounce all fired events types listed in `types`\n * while executing the provided `fn`.\n *\n */\nexport const debounce_events = ( self:TomSelect, types:string[], fn:() => void ) => {\n\tvar type:string;\n\tvar trigger = self.trigger;\n\tvar event_args:{ [key: string]: any } = {};\n\n\t// override trigger method\n\tself.trigger = function(){\n\t\tvar type = arguments[0];\n\t\tif (types.indexOf(type) !== -1) {\n\t\t\tevent_args[type] = arguments;\n\t\t} else {\n\t\t\treturn trigger.apply(self, arguments);\n\t\t}\n\t};\n\n\t// invoke provided function\n\tfn.apply(self, []);\n\tself.trigger = trigger;\n\n\t// trigger queued events\n\tfor( type of types ){\n\t\tif( type in event_args ){\n\t\t\ttrigger.apply(self, event_args[type]);\n\t\t}\n\t}\n};\n\n\n/**\n * Determines the current selection within a text input control.\n * Returns an object containing:\n *   - start\n *   - length\n *\n */\nexport const getSelection = (input:HTMLInputElement):{ start: number; length: number } => {\n\treturn {\n\t\tstart\t: input.selectionStart || 0,\n\t\tlength\t: (input.selectionEnd||0) - (input.selectionStart||0),\n\t};\n};\n\n\n/**\n * Prevent default\n *\n */\nexport const preventDefault = (evt?:Event, stop:boolean=false):void => {\n\tif( evt ){\n\t\tevt.preventDefault();\n\t\tif( stop ){\n\t\t\tevt.stopPropagation();\n\t\t}\n\t}\n}\n\n\n/**\n * Add event helper\n *\n */\nexport const addEvent = (target:EventTarget, type:string, callback:EventListenerOrEventListenerObject, options?:object):void => {\n\ttarget.addEventListener(type,callback,options);\n};\n\n\n/**\n * Return true if the requested key is down\n * Will return false if more than one control character is pressed ( when [ctrl+shift+a] != [ctrl+a] )\n * The current evt may not always set ( eg calling advanceSelection() )\n *\n */\nexport const isKeyDown = ( key_name:keyof (KeyboardEvent|MouseEvent), evt?:KeyboardEvent|MouseEvent ) => {\n\n\tif( !evt ){\n\t\treturn false;\n\t}\n\n\tif( !evt[key_name] ){\n\t\treturn false;\n\t}\n\n\tvar count = (evt.altKey?1:0) + (evt.ctrlKey?1:0) + (evt.shiftKey?1:0) + (evt.metaKey?1:0);\n\n\tif( count === 1 ){\n\t\treturn true;\n\t}\n\n\treturn false;\n};\n\n\n/**\n * Get the id of an element\n * If the id attribute is not set, set the attribute with the given id\n *\n */\nexport const getId = (el:Element,id:string) => {\n\tconst existing_id = el.getAttribute('id');\n\tif( existing_id ){\n\t\treturn existing_id;\n\t}\n\n\tel.setAttribute('id',id);\n\treturn id;\n};\n\n\n/**\n * Returns a string with backslashes added before characters that need to be escaped.\n */\nexport const addSlashes = (str:string):string => {\n\treturn str.replace(/[\\\\\"']/g, '\\\\$&');\n};\n\n/**\n *\n */\nexport const append = ( parent:Element|DocumentFragment, node: string|Node|null|undefined ):void =>{\n\tif( node ) parent.append(node);\n};\n"],"names":["hash_key","value","get_hash","escape_html","str","replace","loadDebounce","fn","delay","timeout","callback","self","loading","Math","max","clearTimeout","setTimeout","loadedSearches","call","debounce_events","types","type","trigger","event_args","arguments","indexOf","apply","getSelection","input","start","selectionStart","length","selectionEnd","preventDefault","evt","stop","stopPropagation","addEvent","target","options","addEventListener","isKeyDown","key_name","count","altKey","ctrlKey","shiftKey","metaKey","getId","el","id","existing_id","getAttribute","setAttribute","addSlashes","append","parent","node"],"mappings":"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"}